<template name='dashboard'>
  <div class="container-fluid">
    <div class="row">
      <div id="fullbuildingcolumn" class="dashboard-column col-xs-4">
        {{> generalbuildingcolumn}}
      </div>
      <div id="hvacbuildingcolumn" class="dashboard-column col-xs-4">
        {{> hvacbuildingcolumn}}
      </div>
      <div id="lightingbuildingcolumn" class="dashboard-column col-xs-4">
        {{> lightingbuildingcolumn}}
      </div>
    </div>
  </div>
</template>

<!-- Render each power meter in the building-wide general column -->
<template name="generalbuildingcolumn">
  <h2 class="dashboard-column-heading">Building Name</h2>
  <div class="dashboard-well">
    {{#each powermeterAll}}
      {{> power_meter_widget}}
    {{/each}}
    <h3 class="dashboard-column-heading">Today's Schedule</h3>
    <div>
      <table class="table table-bordered">
        <thead>
          <tr>
            <td id='day7' class='day'>Sun</td>
            <td id='day1' class='day'>Mon</td>
            <td id='day2' class='day'>Tue</td>
            <td id='day3' class='day'>Wed</td>
            <td id='day4' class='day'>Thu</td>
            <td id='day5' class='day'>Fri</td>
            <td id='day6' class='day'>Sat</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>We</td>
            <td>Wd</td>
            <td>Wd</td>
            <td>Wd</td>
            <td>Wd</td>
            <td>Wd</td>
            <td>We</td>
          </tr>
        </tbody>
      </table>
      <p>Schedule Type: <b>{{daytype}}</b></p>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Category</th>
            <th>Start</th>
            <th>Heat SP</th>
            <th>Cool SP</th>
          </tr>
        </thead>
        <tbody>
        {{#each globalschedule.weekday}}
        <tr class="schedulerow" data-time="{{time}}" id="{{name}}">
          <td>{{name}}</td>
          <td>{{time}}</td>
          <td>{{heatsp}}</td>
          <td>{{coolsp}}</td>
        </tr>
        {{/each}}
        </tbody>
      </table>

    </div>
  </div>
</template>

<template name="hvacbuildingcolumn">
  <h2 class="dashboard-column-heading">HVAC</h2>
  {{#each HVACAll}}
    {{> hvac_zone_widget}}
  {{/each}}
</template>

<template name="lightingbuildingcolumn">
  <h2 class="dashboard-column-heading">Lighting</h2>
  {{#each LightingAll}}
    {{> light_zone_widget}}
  {{/each}}
</template>

<template name="hvac_zone_widget">
  <div class="dashboard-well">
    <h3 class="dashboard-column-heading centertext">
      <a class="detail-link" href="{{pathFor 'zone_detail' zonetype='hvac' zone=zone }}">{{zone}}</a>
    </h3>
    <div class="HVAC-zone-summary" id="HVAC-zone-summary-{{ _id }}"></div>
    <p><b>Cool Setpoint:</b> {{getValue 'temp_cool'}}</p>
    <p><b>Temp:</b> {{getValue 'temp'}}</p>
    <p><b>Heat Setpoint:</b> {{getValue 'temp_heat'}}</p>
    <div class="panel panel-default">
      <div class="panel-heading table-heading">Sensors</div>
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th class="col-md-3">Room</th>
            <th class="col-md-3">Temperature</th>
            <th class="col-md-3">Humidity</th>
          </tr>
        </thead>
        <tbody>
        {{#each sensors}}
          <tr>
            <td>{{room}}</td>
            <td><div class="sparkline-container" id="sparkline-temperature-container-{{ _id }}"></div>{{getValue 'temperature'}}</td>
            <td><div class="sparkline-container" id="sparkline-humidity-container-{{ _id }}"></div>{{getValue 'humidity'}}</td>
          </tr>
        {{/each}}
        </tbody>
      </table>
    </div>
  </div>
</template>

<template name="light_zone_widget">
  <div class="dashboard-well">
    <h3 class="dashboard-column-heading centertext">
      <a class="detail-link" href="{{pathFor 'zone_detail' zonetype='lighting' zone=zone }}">{{zone}}</a>
    </h3>
    <div class="panel panel-default">
      <div class="panel-heading table-heading">Light Groups</div>
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th>Light Group</th>
            <th>On/Off</th>
            <th>Brightness</th>
            <th>Hue</th>
          </tr>
        </thead>
        <tbody>
          {{#each groups}}
          <tr>
            <td>{{group}}</td>
            <td>{{getValue 'on'}}</td>
            <td>{{getValue 'bri'}}</td>
            <td>{{getValue 'hue'}}</td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
    {{#each internals}}
    <div class="infobox dark well">
      <p><b>Task Light:</b> {{path}} </p>
    </div>
    {{/each}}
    {{#each sensors}}
    <div class="infobox dark well">
      <p><b>Room:</b> {{room}} </p>
      <p><b>Illumination:</b> {{getValue 'illumination'}} </p>
    </div>
    {{/each}}
  </div>
</template>

<template name="power_meter_widget">
  <div class="infobox dark well">
    <div class="sparkline-container" id="sparkline-container-{{ _id }}"></div>
    <div class="sparkline-label">
      <span>Demand:</span>
      <span class="sparkline-value">{{getValue 'demand'}}</span>
      <span class="sparkline-extents" id="sparkline-extents-{{ _id }}"></span>
    </div>
  </div>
</template>

<template name="zone_detail">
  <div class="zone-detail-container">
    {{#if is_hvac type}}
      {{#each points}}
        {{> thermostat}}
      {{/each}}
    {{else}}{{#if is_lighting type}}
      {{#each points}}
        {{> lightinggroup}}
      {{/each}}
    {{/if}}{{/if}}
  </div>
</template>

<template name="thermostat">
  <h2 class="dashboard-column-heading">Zone: {{zone}}</h2>
  <h3 class="dashbaord-column-heading">{{path}}</h3>
  <div class='table-responsive'>
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Path</th>
          <th>Value</th>
          <th>Type</th>
        </tr>
      </thead>
      <tbody>
        {{#if has 'temp'}}
        <tr id="{{uuid 'temp'}}">
          {{> point timeseries.temp}}
        </tr>
        {{/if}}
 
        {{#if has 'humidity'}}
        <tr id="{{uuid 'humidity'}}">
          {{> point timeseries.humidity}}
        </tr>
        {{/if}}
 
        {{#if has 'hvac_state'}}
        <tr id="{{uuid 'hvac_state'}}">
          {{> point timeseries.hvac_state}}
        </tr>
        {{/if}}
 
        {{#if has 'temp_heat'}}
        <tr id="{{uuid 'temp_heat'}}">
          {{> point timeseries.temp_heat}}
        </tr>
        {{/if}}
 
        {{#if has 'temp_cool'}}
        <tr id="{{uuid 'temp_cool'}}">
          {{> point timeseries.temp_cool}}
        </tr>
        {{/if}}
 
        {{#if has 'hold'}}
        <tr id="{{uuid 'hold'}}">
          {{> point timeseries.hold}}
        </tr>
        {{/if}}
 
        {{#if has 'override'}}
        <tr id="{{uuid 'override'}}">
          {{> point timeseries.override}}
        </tr>
        {{/if}}
 
        {{#if has 'hvac_mode'}}
        <tr id="{{uuid 'hvac_mode'}}">
          {{> point timeseries.hvac_mode}}
        </tr>
        {{/if}}
 
        {{#if has 'fan_mode'}}
        <tr id="{{uuid 'fan_mode'}}">
          {{> point timeseries.fan_mode}}
        </tr>
        {{/if}}
 
      </tbody>
    </table>
  </div>
</template>

<template name="point">
</template>

<template name="lightinggroup">
  <h2 class="dashboard-column-heading">{{zone}}</h2>
  <h3 class="dashboard-column-heading">{{path}}</h3>
  <div class='table-responsive'>
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Path</th>
          <th>Value</th>
          <th>Type</th>
        </tr>
      </thead>
      <tbody>
        {{#if has 'on'}}
        <tr id="{{uuid 'on'}}">
          {{> point timeseries.on }}
        </tr>
        {{/if}}

        {{#if has 'bri'}}
        <tr id="{{uuid 'bri'}}">
          {{> point timeseries.bri }}
        </tr>
        {{/if}}

        {{#if has 'hue'}}
        <tr id="{{uuid 'hue'}}">
          {{> point timeseries.hue }}
        </tr>
        {{/if}}

      </tbody>
    </table>
  </div>
</template>
